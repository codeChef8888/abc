<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>abc</title>


	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">



	<link href="/styles/home.css" th:href="@{/styles/home.css}" type="text/css" media="all" rel="stylesheet" />

	<link href="/styles/exchangeForm.css" th:href="@{/styles/exchangeForm.css}" type="text/css" media="all"
		rel="stylesheet" />


	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


</head>

<body>
	<div id="postResultDiv" align="center"></div>
	<div class="container my-2">
		<ul>
			<li><a th:href="@{/usercoins/1}">ABC</a></li>
			<li><a th:href="@{/usercoins/1}">Home</a></li>
			<li><a href="contact.asp">Cryptos</a></li>
		</ul>
	</div>

	<div class="container my-2">

		<table class="table table-borderless table-hover table-responsive-md">
			<thead>
				<tr>
					<th>No. of crypto coin types</th>
					<th>Total no. of coins</th>
				</tr>
			</thead>
			<tbody>

				<tr>
					<td th:text="${totalCoins}">
						</tdht>
					<td th:text="${#aggregates.sum(listUserCoins.![amount])}"></td>

				</tr>

			</tbody>
		</table>

	</div>
	<div class="container my-2">

		<h1>Crypto Coins</h1>

		<table class="table table-borderless table-hover table-responsive-md">
			<thead>
				<tr>
					<th>photo</th>
					<th>coins</th>
					<th>amount</th>
					<th>Exchange</th>
				</tr>
			</thead>
			<tbody>

				<tr th:each="userCoins , iStat : ${listUserCoins}" th:with="userId = ${userCoins.amount}">
					<td> <img th:src="${userCoins.coin.photo}" width="50" height="40"></td>
					<td th:text="${userCoins.coin.name}"></td>
					<td th:text="${userCoins.amount}"></td>
					<td>


						<!-- Button trigger modal -->
						<button type="button" id="exchange-btn" class="btn btn-exchange btn-primary" data-toggle="modal"
							data-target="#exampleModal"
							th:onclick="'exchanger('+${userCoins.coin.id}+','+${userCoins.amount}+')'">Exchange</button>




					</td>

				</tr>

			</tbody>
		</table>
		<!-- Modal -->
		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
			aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLongTitle">Exchange <strong id="coin-name"></strong>
							coins with.. </h5>
						<button type="button" class="close reset-exchange" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">

						<div id="exchange-form">

							<input type="hidden" id="fCoin" name="fromCoin" class="form-control">

							<input type="hidden" id="aCoins" name="availableCoins">



							<label for="tCoin">Available Coins:</label>
							<select id="tCoin" name="toCoin">
								<option th:each="datas : ${listUserCoins}" th:text="${datas.coin.name}"
									th:value="${datas.coin.id}"></option>
							</select>

							<label for="coinAmt">Amount of <strong></strong>
							</label> <input type="number" id="coinAmt" name="coinAmount" placeholder="No of coins.."
								class="form-control" required>
							<p id="demo"></p>
						</div>


					</div>
					<div class="modal-footer">

						<button id="save-exchange" type="button" class="btn btn-primary btn-success">Exchange</button>

						<button id="reset-btn" type="button" class="btn btn-secondary reset-exchange" data-dismiss="modal">Close</button></input>

					</div>
				</div>
			</div>
		</div>
	</div>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
		integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
		crossorigin="anonymous"></script>

	<script src="https://code.jquery.com/jquery-3.6.0.js"
		integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

	<script>

		function exchanger(from, to) {

			$("#fCoin").val(from);
			$("#aCoins").val(to);


		}

		$("#save-exchange").click(function () {

			var formData = {
				fromCoin: $("#fCoin").val(),
				toCoin: $("#tCoin").val(),
				coinAmount: $("#coinAmt").val()

			}
			$.ajax({
				type: "POST",
				contentType: "application/json",
				url: "/usercoins/1/exchange",
				data: JSON.stringify(formData),
				dataType: 'json',
				success: function (result) {

					if (result.status == "success") {

						$("#demo").html("<strong>" + result.message + "</strong>");

						setTimeout(function () {
							window.location = "/usercoins/1";
						}, 1000);

					} else {
						$("#demo").html("<strong>" + result.message + "</strong>");
					}
				},
				error: function (e) {
					alert("Please enter the amount!")
					console.log("ERROR: ", e);
				}
			});


		});

		$(".reset-exchange").click(function () {
		$("#coinAmt").val(0);
		$("#demo").html("<strong></strong>");
		});



		function exchange(from) {
			console.log(from);
			debugger
			ajaxPost();
		}

		function ajaxPost() {

			console.log("Hi Arya");

			console.log("Hi Ashim");
			// PREPARE FORM DATA
			var formData = {
				fromCoin: $("#fCoin").val(),
				toCoin: $("#tCoin").val(),
				coinAmount: $("#coinAmt").val()
			}

			console.log(formData);
			debugger

			// DO POST
			$.ajax({
				type: "POST",
				contentType: "application/json",
				url: "/usercoins/1/exchange",
				data: JSON.stringify(formData),
				dataType: 'json',
				success: function (result) {

					if (result.status == "success") {

						$("#demo").html("<strong>" + result.message + "</strong>");



					} else {
						$("#demo").html("<strong>" + result.message + "</strong>");
					}
				},
				error: function (e) {
					alert("Error!")
					console.log("ERROR: ", e);
				}
			});

		}

	</script>

</body>




</html>